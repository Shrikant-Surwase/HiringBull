// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DIRECT_URL")
}

enum ExperienceLevel {
  INTERNSHIP
  FRESHER_OR_LESS_THAN_1_YEAR
  ONE_TO_THREE_YEARS
}

enum CompanyCategory {
  TECH_GIANT
  FINTECH_GIANT
  INDIAN_STARTUP
  GLOBAL_STARTUP
  YCOMBINATOR
  MASS_HIRING
  HFT
}

enum PlanType {
  ONE_MONTH
  THREE_MONTH
  SIX_MONTH
}

enum PaymentStatus {
  PENDING
  SUCCESS
  FAILED
}

model User {
  id                     String    @id @default(uuid())
  clerkId                String?   @unique // Clerk user ID for auth sync
  name                   String
  img_url                String?
  email                  String    @unique
  active                 Boolean   @default(true)
  is_experienced         Boolean   @default(false)
  college_name           String?
  cgpa                   String?
  company_name           String?
  years_of_experience    Float?
  resume_link            String?
  segment                String?
  experience_level       ExperienceLevel?
  onboarding_completed   Boolean   @default(false)
  onboarding_completed_at DateTime?
  promo_code             String?   @unique
  promo_code_used        String?
  tokens_left            Int?      @default(3)
  tokens_last_update     DateTime?
  total_paid             Float?    @default(0)
  last_paid              Float?
  current_plan_start     DateTime?
  current_plan_end      DateTime?
  created_at             DateTime  @default(now())
  updated_at             DateTime  @updatedAt
  expiry                 DateTime?
  isPaid                 Boolean   @default(false)
  planExpiry             DateTime?
  payments               Payment[]
  comments               Comment[]
  followedCompanies      Company[]
  devices                Device[]
  outreachRequests       OutreachRequest[]

  @@index([email])
  @@index([clerkId])
  @@index([segment])
}

model Company {
  id          String   @id @default(uuid())
  name        String   @unique
  logo        String?
  description String?
  category    CompanyCategory?
  users       User[]
  jobs        Job[]
  createdAt   DateTime @default(now())
  updatedAt   DateTime @default(now()) @updatedAt 

  @@index([category])
  @@index([name])
}

model Job {
  id              String   @id @default(uuid())
  company         String
  companyId       String?
  companyRel      Company? @relation(fields: [companyId], references: [id])
  segment         String?
  title           String
  careerpage_link String?
  company_id      String?
  created_at      DateTime @default(now())
  created_by      String?

  @@index([segment])
  @@index([companyId])
  @@index([created_at])
}

model SocialPost {
  id          String   @id @default(uuid())
  name        String
  description String
  segment     String?
  company     String?
  source      String?  // "linkedin", "reddit", "twitter", "direct"
  source_link String?
  image_link  String?
  created_at  DateTime @default(now())
  created_by  String?
  comments    Comment[]

  @@index([source])
  @@index([segment])
  @@index([created_at])
}

model Comment {
  id        String     @id @default(uuid())
  content   String
  userId    String
  user      User       @relation(fields: [userId], references: [id])
  postId    String
  post      SocialPost @relation(fields: [postId], references: [id])
  createdAt DateTime   @default(now())

  @@index([userId])
  @@index([postId])
}

model Device {
  id        String   @id @default(uuid())
  token     String   @unique // FCM token or device identifier
  type      String?  // ios, android, web
  userId    String?
  user      User?    @relation(fields: [userId], references: [id], onDelete: Cascade)
  createdAt DateTime @default(now())

  @@index([userId])
  @@index([token])
}

model Payment {
  id              String        @id @default(uuid())
  orderId         String
  paymentId       String?
  signature       String?
  amount          Float
  status          PaymentStatus @default(PENDING)

  userId          String
  user            User          @relation(fields: [userId], references: [id])

  planType        PlanType

  // ðŸ”‘ Referral fields
  referralCode    String?
  referredByEmail String?
  referralDiscount Float?       // e.g. 50
  referralApplied Boolean       @default(false)

  createdAt       DateTime      @default(now())

  @@index([userId])
  @@index([orderId])
  @@index([referralCode])
  @@index([planType])
}

model OutreachRequest {
  id           String   @id @default(uuid())

  userId       String
  user         User     @relation(fields: [userId], references: [id])

  email        String
  companyName  String

  reason       String          // âœ… REQUIRED (compulsory)

  jobId        String?
  resumeLink   String?
  message      String?

  status       String   @default("PENDING")

  createdAt    DateTime @default(now())
  reviewedAt   DateTime?
  sentAt       DateTime?

  @@index([userId])
  @@index([companyName])
  @@index([status])
  @@index([createdAt])
}

model WebRegistration {
  id            String        @id @default(uuid())
  email         String        @unique
  currentPlan   PlanType
  planStart     DateTime
  planEnd       DateTime
  paidAmount    Float
  referralCode  String?
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt

  @@index([email])
}
